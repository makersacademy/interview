<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Templates with Opal</title>

  <link href="../../stylesheets/application.css" rel="stylesheet" />
  <link href="http://code.ionicframework.com/ionicons/1.4.1/css/ionicons.min.css" rel="stylesheet" />
  <script src="../../javascripts/application.js"></script>
</head>
<body class="docs docs_templates docs_templates_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
  <div class='container'>
    <div class='navbar-header'>
      <a class='navbar-brand' href='/'>
        <img height='22' src='http://assets.makersacademy.com/images/logo/ma-white.png' width='44'>
        Makers Academy
      </a>
      <button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
    </div>
    <div class='navbar-collapse collapse' id='opal-navbar'>
      <ul class='nav navbar-nav'>
        <li>
          <a href='https://github.com/makersacademy'>
            <i class='ion-social-github'></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <script>$('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')</script>

  <div class="container">
      <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <h1>Templates with Opal</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 col-md-push-8">
        <ul class="nav opal-sidebar">
<li class="toc-list-chapter"><a href="#basic-templates">Basic Templates</a>
<ul class="subchapter">
<li class="toc-list-subchapter"><a href="#registered-templates">Registered Templates</a></li>
</ul>
<li class="toc-list-chapter"><a href="#haml-templates">Haml templates</a></li>
<li class="toc-list-chapter"><a href="#erb-templates">ERB Templates</a></li></ul>
      </div>

      <div class="col-md-8 col-md-pull-4">
        <h1 id="templates">Templates</h1>

<p>Opal includes support for running erb templates on the client. Haml templates
can also be used via the <code>opal-haml</code> gem.</p>

<h2 id="basic-templates">Basic Templates</h2>

<p>If you require <code>template.rb</code> from the stdlib, then all compiled templates will
be available on the <code>Template</code> object. Each compiled template will be an
instance of <code>Template</code>, which provides a basic standard rendering api to make
rendering a uniform method on the client.</p>

<p>For example, to access a template named <code>user</code>:</p>
<pre class="highlight ruby"><code><span class="nb">require</span> <span class="s1">'template'</span>

<span class="n">template</span> <span class="o">=</span> <span class="no">Template</span><span class="p">[</span><span class="s1">'user'</span><span class="p">]</span>
<span class="n">context</span>  <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'Ford Prefect'</span><span class="p">)</span>

<span class="nb">puts</span> <span class="n">template</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="c1"># =&gt; "&lt;div&gt;...&lt;/div&gt;"</span>
</code></pre>

<p><code>#render()</code> will run the template in the given context, and return the result
as a string. This is usually a html string, but it can be used for any dynamic
content.</p>

<h3 id="registered-templates">Registered Templates</h3>

<p>You can get a quick list of all registered templates using <code>.paths</code>:</p>
<pre class="highlight ruby"><code><span class="no">Template</span><span class="p">.</span><span class="nf">paths</span>
<span class="c1"># =&gt; [#&lt;Template: 'views/user'&gt;, #&lt;Template: 'login'&gt;]</span>
</code></pre>

<p>These names are the keys used to access a template:</p>
<pre class="highlight ruby"><code><span class="no">Template</span><span class="p">[</span><span class="s1">'login'</span><span class="p">]</span>
<span class="c1"># =&gt; #&lt;Template: 'login'&gt;</span>
</code></pre>

<h2 id="haml-templates">Haml templates</h2>

<p><code>opal-haml</code> allows <code>.haml</code> templates to be compiled, just like Opal compiles
ruby code, ready to run on the client.</p>

<p>To get started, add to your Gemfile:</p>
<pre class="highlight ruby"><code><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'opal'</span>
<span class="n">gem</span> <span class="s1">'opal-haml'</span>
</code></pre>

<p><code>opal-haml</code> simply registers the <code>.haml</code> template to be handled under sprockets.
This means, that you can simply <code>require()</code> a haml template in your code.</p>

<p>Lets say you have the following simple Opal app:</p>
<pre class="highlight ruby"><code><span class="c1"># app/application.rb</span>
<span class="nb">require</span> <span class="s1">'opal'</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>

<p>We want to create an instance of the <code>User</code> class and render it using a haml
template. Lets first create that template as <code>app/views/user.haml</code>:</p>
<pre class="highlight haml"><code><span class="c">-# app/views/user.haml
</span><span class="nc">.row</span>
  <span class="nc">.col-md-6</span>
    <span class="p">=</span> <span class="nb">self</span><span class="p">.</span><span class="nf">name</span>
  <span class="nc">.col-md-6</span>
    <span class="p">=</span> <span class="nb">self</span><span class="p">.</span><span class="nf">age</span>
</code></pre>

<p>You are nearly ready to go. Lets create a user instance and render the template
in the context of that user:</p>
<pre class="highlight ruby"><code><span class="c1"># app/application.rb</span>
<span class="nb">require</span> <span class="s1">'opal'</span>
<span class="nb">require</span> <span class="s1">'views/user'</span>

<span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">:age</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">ford</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'Ford Prefect'</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
<span class="n">template</span> <span class="o">=</span> <span class="no">Template</span><span class="p">[</span><span class="s1">'views/user'</span><span class="p">]</span>

<span class="nb">puts</span> <span class="n">template</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">ford</span><span class="p">)</span>
</code></pre>

<p>Note, when requiring haml templates you do not need to specify the <code>.haml</code>
extension. This code will print the rendered html to the console. If you
check it out, you should see it compiled into something like the following:</p>
<pre class="highlight html"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
    Ford Prefect
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-6"</span><span class="nt">&gt;</span>
    42
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<h2 id="erb-templates">ERB Templates</h2>

<p>Support for <code>erb</code> templates is built in directly to the Opal gem and stdlib.
There is one caveat though when working with sprockets - it must have the
<code>.opalerb</code> file extension, instead of <code>.erb</code>. This is because sprockets has a
built in handler for <code>.erb</code> files.</p>

<p>If we have the same user class as above, create an <code>app/views/user.opalerb</code>
file:</p>
<pre class="highlight erb"><code><span class="c">&lt;!-- app/views/user.opalerb --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-3"</span><span class="nt">&gt;</span><span class="cp">&lt;%=</span> <span class="nb">self</span><span class="p">.</span><span class="nf">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre>

<p>Again, you must then require the template (without the <code>.opalerb</code> extension):</p>
<pre class="highlight ruby"><code><span class="c1"># app/application.rb</span>
<span class="nb">require</span> <span class="s1">'opal'</span>
<span class="nb">require</span> <span class="s1">'views/user'</span>
</code></pre>

<p>And then you can access and render the template:</p>
<pre class="highlight ruby"><code><span class="c1"># app/application.rb</span>

<span class="n">template</span> <span class="o">=</span> <span class="no">Template</span><span class="p">[</span><span class="s1">'views/user'</span><span class="p">]</span>
<span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'Ford Prefect'</span><span class="p">)</span>

<span class="nb">puts</span> <span class="n">template</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
<span class="c1"># =&gt; "&lt;div class="row"&gt;...&lt;/div&gt;"</span>
</code></pre>

      </div>
    </div>
  </div>

  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  Powered by <a href="https://github.com/opal/">Opal</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
