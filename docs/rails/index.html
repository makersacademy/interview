<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Rails</title>

  <link href="../../stylesheets/application.css" rel="stylesheet" />
  <link href="http://code.ionicframework.com/ionicons/1.4.1/css/ionicons.min.css" rel="stylesheet" />
  <script src="../../javascripts/application.js"></script>
</head>
<body class="docs docs_rails docs_rails_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
  <div class='container'>
    <div class='navbar-header'>
      <a class='navbar-brand' href='/'>
        <img height='22' src='http://assets.makersacademy.com/images/logo/ma-white.png' width='44'>
        Makers Academy
      </a>
      <button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
    </div>
    <div class='navbar-collapse collapse' id='opal-navbar'>
      <ul class='nav navbar-nav'>
        <li>
          <a href='https://github.com/makersacademy'>
            <i class='ion-social-github'></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <script>$('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')</script>

  <div class="container">
      <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <h1>Rails</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 col-md-push-8">
        <ul class="nav opal-sidebar">
<li class="toc-list-chapter"><a href="#opal-in-a-rails-application">Opal in a Rails application</a></li>
<li class="toc-list-chapter"><a href="#basic-usage-through-the-asset-pipeline">Basic usage through the asset pipeline</a>
<ul class="subchapter">
<li class="toc-list-subchapter"><a href="#as-a-template">As a template</a>
<li class="toc-list-subchapter"><a href="#as-a-haml-filter-optional">As a Haml filter (optional)</a>
<li class="toc-list-subchapter"><a href="#spec">Spec!</a></li>
</ul></li></ul>
      </div>

      <div class="col-md-8 col-md-pull-4">
        <h2 id="opal-in-a-rails-application">Opal in a Rails application</h2>

<p>Add Opal to your Gemfile:</p>
<pre class="highlight ruby"><code><span class="n">gem</span> <span class="s1">'opal-rails'</span>
</code></pre>

<p>Or to start off with Opal when you build your new Rails app:</p>
<pre class="highlight shell"><code>rails new &lt;app-name&gt; --javascript<span class="o">=</span>opal
</code></pre>

<h2 id="basic-usage-through-the-asset-pipeline">Basic usage through the asset pipeline</h2>
<pre class="highlight javascript"><code><span class="c1">// app/assets/application.js.rb</span>

<span class="c1">//= require opal</span>
<span class="c1">//= require opal_ujs</span>
<span class="c1">//= require turbolinks</span>
<span class="c1">//= require_tree .</span>
</code></pre>

<p>Opal requires are forwarded to the Asset Pipeline at compile time (similarly to what happens for RubyMotion). You can use either the <code>.rb</code> or <code>.opal</code> extension:</p>
<pre class="highlight ruby"><code><span class="c1"># app/assets/javascripts/greeter.js.rb</span>

<span class="nb">puts</span> <span class="s2">"G'day world!"</span> <span class="c1"># check the console!</span>

<span class="c1"># Dom manipulation</span>
<span class="nb">require</span> <span class="s1">'opal-jquery'</span>

<span class="no">Document</span><span class="p">.</span><span class="nf">ready?</span> <span class="k">do</span>
  <span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'body &gt; header'</span><span class="p">).</span><span class="nf">html</span> <span class="o">=</span> <span class="s1">'&lt;h1&gt;Hi there!&lt;/h1&gt;'</span>
<span class="k">end</span>
</code></pre>

<h3 id="as-a-template">As a template</h3>

<p>You can use it for your views too, it even inherits instance and local variables from actions:</p>
<pre class="highlight ruby"><code><span class="c1"># app/controllers/posts_controller.rb</span>

<span class="k">def</span> <span class="nf">create</span>
  <span class="vi">@post</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">create!</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:post</span><span class="p">])</span>
  <span class="n">render</span> <span class="ss">type: :js</span><span class="p">,</span> <span class="ss">locals: </span><span class="p">{</span><span class="ss">comments_html: </span><span class="n">render_to_string</span><span class="p">(</span><span class="vi">@post</span><span class="p">.</span><span class="nf">comments</span><span class="p">)}</span>
<span class="k">end</span>
</code></pre>

<p>Each assign is filtered through JSON so it&#39;s reduced to basic types:</p>
<pre class="highlight ruby"><code><span class="c1"># app/views/posts/create.js.opal</span>

<span class="n">post</span> <span class="o">=</span> <span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'.post'</span><span class="p">)</span>
<span class="n">post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'.title'</span><span class="p">).</span><span class="nf">html</span>    <span class="o">=</span> <span class="vi">@post</span><span class="p">[</span><span class="ss">:title</span><span class="p">]</span>
<span class="n">post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'.body'</span><span class="p">).</span><span class="nf">html</span>     <span class="o">=</span> <span class="vi">@post</span><span class="p">[</span><span class="ss">:body</span><span class="p">]</span>
<span class="n">post</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'.comments'</span><span class="p">).</span><span class="nf">html</span> <span class="o">=</span> <span class="n">comments_html</span>
</code></pre>

<h3 id="as-a-haml-filter-optional">As a Haml filter (optional)</h3>

<p>Of course you need to require <code>haml-rails</code> separately since its presence is not assumed</p>
<pre class="highlight haml"><code><span class="c">-# app/views/posts/show.html.haml
</span>
<span class="nt">%article</span><span class="nc">.post</span>
  <span class="nt">%h1</span><span class="nc">.title</span><span class="p">=</span> <span class="n">post</span><span class="p">.</span><span class="nf">title</span>
  <span class="nc">.body</span><span class="p">=</span> <span class="n">post</span><span class="p">.</span><span class="nf">body</span>

<span class="nt">%a</span><span class="nf">#show-comments</span> Display Comments!

<span class="nc">.comments</span><span class="p">(</span><span class="na">style=</span><span class="s">"display:none;"</span>)
  <span class="p">-</span> <span class="n">post</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span>
    <span class="nc">.comment</span><span class="p">=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span>

<span class="nd">:opal
</span>  <span class="nd">Document.ready? do</span>
    <span class="nd">Element.find('#show-comments').on :click do |click|</span>
      <span class="nd">click.prevent_default</span>
      <span class="nd">click.current_target.hide</span>
      <span class="nd">Element.find('.comments').effect(:fade_in)</span>
    <span class="nd">end</span>
  <span class="nd">end</span>
</code></pre>

<h3 id="spec">Spec!</h3>

<p>Add specs into <code>app/assets/javascripts/spec</code>:</p>

<p>and then a spec folder with you specs!</p>
<pre class="highlight ruby"><code><span class="c1"># app/assets/javascripts/spec/example_spec.js.rb</span>

<span class="n">describe</span> <span class="s1">'a spec'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'has successful examples'</span> <span class="k">do</span>
    <span class="s1">'I run'</span><span class="p">.</span><span class="nf">should</span> <span class="o">=~</span> <span class="sr">/run/</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>Then visit <code>/opal_spec</code> from your app and <strong>reload at will</strong>.</p>

<p><img alt="1 examples, 0 failures" src="http://f.cl.ly/items/001n0V0g0u0v14160W2G/Schermata%2007-2456110%20alle%201.06.29%20am.png" /></p>

      </div>
    </div>
  </div>

  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  Powered by <a href="https://github.com/opal/">Opal</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
