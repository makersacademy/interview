<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>Opal and jQuery</title>

  <link href="../../stylesheets/application.css" rel="stylesheet" />
  <link href="http://code.ionicframework.com/ionicons/1.4.1/css/ionicons.min.css" rel="stylesheet" />
  <script src="../../javascripts/application.js"></script>
</head>
<body class="docs docs_jquery docs_jquery_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
  <div class='container'>
    <div class='navbar-header'>
      <a class='navbar-brand' href='/'>
        <img height='22' src='http://assets.makersacademy.com/images/logo/ma-white.png' width='44'>
        Makers Academy
      </a>
      <button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
    </div>
    <div class='navbar-collapse collapse' id='opal-navbar'>
      <ul class='nav navbar-nav'>
        <li>
          <a href='https://github.com/makersacademy'>
            <i class='ion-social-github'></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <script>$('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')</script>

  <div class="container">
      <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <h1>Opal and jQuery</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 col-md-push-8">
        <ul class="nav opal-sidebar">
<ul class="subchapter">
<li class="toc-list-subchapter"><a href="#getting-started">Getting Started</a>
<li class="toc-list-subchapter"><a href="#how-does-opal-jquery-work">How does opal-jquery work</a>
<li class="toc-list-subchapter"><a href="#interacting-with-the-dom">Interacting with the DOM</a>
<li class="toc-list-subchapter"><a href="#http-ajax-requests">HTTP/AJAX requests</a></li>
</ul></li></ul>
      </div>

      <div class="col-md-8 col-md-pull-4">
        <h1 id="jquery">JQuery</h1>

<p><code>opal-jquery</code> offers a nicer Ruby-like syntax for JQuery (and Zepto). It is
useful for projects which cannot use <code>opal-browser</code> due to a reliance on jQuery
for plugins or other libraries.</p>
<pre class="highlight ruby"><code><span class="n">foos</span> <span class="o">=</span> <span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'.foo'</span><span class="p">)</span>
<span class="c1"># =&gt; [&lt;div class="foo"&gt;, ...]</span>

<span class="n">foos</span><span class="p">.</span><span class="nf">class</span>
<span class="c1"># =&gt; JQuery</span>

<span class="n">foos</span><span class="p">.</span><span class="nf">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">alert</span> <span class="s2">"element was clicked"</span>
<span class="k">end</span>
</code></pre>

<h3 id="getting-started">Getting Started</h3>

<h4 id="installation">Installation</h4>

<p><code>opal-jquery</code> is distributed as a gem, and needs to be added to your <code>Gemfile</code>:</p>
<pre class="highlight ruby"><code><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'opal'</span>
<span class="n">gem</span> <span class="s1">'opal-jquery'</span>
</code></pre>

<h4 id="usage">Usage</h4>

<p><code>opal-jquery</code> can now be easily added to your Opal application sources using a
standard require:</p>
<pre class="highlight ruby"><code><span class="c1"># app/application.rb</span>
<span class="nb">require</span> <span class="s1">'opal'</span>
<span class="nb">require</span> <span class="s1">'jquery'</span>
<span class="nb">require</span> <span class="s1">'opal-jquery'</span>

<span class="n">alert</span> <span class="s2">"Hello from jQuery + Opal"</span>
</code></pre>

<blockquote>
<p><strong>Note</strong>: this file requires two important dependencies, <code>jquery</code> and <code>opal-jquery</code>.
You need to bring your own <code>jquery.js</code> file as the gem does not include one. If
you are using the asset pipeline with rails, then this should be available
already, otherwise download a copy and place it into <code>app/</code> or whichever directory
you are compiling assets from. You can alternatively require a zepto instance.</p>
</blockquote>

<p>The <code>#alert</code> method is provided by <code>opal-jquery</code>. If the message displays, then
<code>jQuery</code> support should be working.</p>

<h3 id="how-does-opal-jquery-work">How does opal-jquery work</h3>

<p><code>opal-jquery</code> provides an <code>Element</code> class, whose instances are toll-free
bridged instances of jQuery objects. Just like Ruby arrays are just JavaScript
arrays, <code>Element</code> instances are just jQuery objects. This makes interaction
with jQuery plugins much easier.</p>

<p>Also, <code>Element</code> will try to bridge with Zepto if it cannot find jQuery loaded,
making it ideal for mobile applications as well.</p>

<h3 id="interacting-with-the-dom">Interacting with the DOM</h3>

<h4 id="finding-elements">Finding Elements</h4>

<p>opal-jquery provides the <code>Element</code> class, which can be used to find elements in
the current document:</p>
<pre class="highlight ruby"><code><span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#header'</span><span class="p">)</span>
</code></pre>

<p><code>Element.find</code> is aliased to <code>Element[]</code>:</p>
<pre class="highlight ruby"><code><span class="no">Element</span><span class="p">[</span><span class="s1">'.my-class'</span><span class="p">]</span>
</code></pre>

<p>These methods acts just like <code>$(&#39;selector&#39;)</code>, and can use any jQuery
compatible selector:</p>
<pre class="highlight ruby"><code><span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#navigation li:last'</span><span class="p">)</span>
</code></pre>

<p>The result is just a jQuery instance, which is toll-free bridged to
instances of the <code>Element</code> class in Ruby:</p>
<pre class="highlight ruby"><code><span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'.foo'</span><span class="p">).</span><span class="nf">class</span>
<span class="c1"># =&gt; Element</span>
</code></pre>

<p>Instances of <code>Element</code> also have the <code>#find</code> method available for
finding elements within the scope of each DOM node represented by
the instance:</p>
<pre class="highlight ruby"><code><span class="n">el</span> <span class="o">=</span> <span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#header'</span><span class="p">)</span>
<span class="n">el</span><span class="p">.</span><span class="nf">find</span> <span class="s1">'.foo'</span>
<span class="c1"># =&gt; #&lt;Element .... &gt;</span>
</code></pre>

<h4 id="running-code-on-document-ready">Running code on document ready</h4>

<p>Just like jQuery, opal-jquery requires the document to be ready to
be able to fully interact with the page. Any top level access should
use the <code>ready?</code> method:</p>
<pre class="highlight ruby"><code><span class="no">Document</span><span class="p">.</span><span class="nf">ready?</span> <span class="k">do</span>
  <span class="n">alert</span> <span class="s2">"document is ready to go!"</span>
<span class="k">end</span>
</code></pre>

<p>The <code>Kernel#alert</code> method is shown above too.</p>

<h4 id="event-handling">Event handling</h4>

<p>The <code>Element#on</code> method is used to attach event handlers to elements:</p>
<pre class="highlight ruby"><code><span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#header'</span><span class="p">).</span><span class="nf">on</span> <span class="ss">:click</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"The header was clicked!"</span>
<span class="k">end</span>
</code></pre>

<p>Selectors can also be passed as a second argument to handle events
on certain children:</p>
<pre class="highlight ruby"><code><span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#header'</span><span class="p">).</span><span class="nf">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">,</span> <span class="s1">'.foo'</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"An element with a 'foo' class was clicked"</span>
<span class="k">end</span>
</code></pre>

<p>An <code>Event</code> instance is optionally passed to block handlers as well,
which is toll-free bridged to jQuery events:</p>
<pre class="highlight ruby"><code><span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#my_link'</span><span class="p">).</span><span class="nf">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">evt</span><span class="o">|</span>
  <span class="n">evt</span><span class="p">.</span><span class="nf">stop_propagation</span>
  <span class="nb">puts</span> <span class="s2">"stopped the event!"</span>
<span class="k">end</span>
</code></pre>

<p>You can access the element which triggered the event by <code>#current_target</code>.</p>
<pre class="highlight ruby"><code><span class="no">Document</span><span class="p">.</span><span class="nf">on</span> <span class="ss">:click</span> <span class="k">do</span> <span class="o">|</span><span class="n">evt</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"clicked on: </span><span class="si">#{</span><span class="n">evt</span><span class="p">.</span><span class="nf">current_target</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre>

<h4 id="css-styles-and-classnames">CSS styles and classnames</h4>

<p>The various jQuery methods are available on <code>Element</code> instances:</p>
<pre class="highlight ruby"><code><span class="n">foo</span> <span class="o">=</span> <span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'.foo'</span><span class="p">)</span>

<span class="n">foo</span><span class="p">.</span><span class="nf">add_class</span> <span class="s1">'blue'</span>
<span class="n">foo</span><span class="p">.</span><span class="nf">remove_class</span> <span class="s1">'foo'</span>
<span class="n">foo</span><span class="p">.</span><span class="nf">toggle_class</span> <span class="s1">'selected'</span>
</code></pre>

<p>There are also added convenience methods for opal-jquery:</p>
<pre class="highlight ruby"><code><span class="n">foo</span> <span class="o">=</span> <span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#header'</span><span class="p">)</span>

<span class="n">foo</span><span class="p">.</span><span class="nf">class_name</span>
<span class="c1"># =&gt; 'red lorry'</span>

<span class="n">foo</span><span class="p">.</span><span class="nf">class_name</span> <span class="o">=</span> <span class="s1">'yellow house'</span>

<span class="n">foo</span><span class="p">.</span><span class="nf">class_name</span>
<span class="c1"># =&gt; 'yellow house'</span>
</code></pre>

<p><code>Element#css</code> also exists for getting/setting css styles:</p>
<pre class="highlight ruby"><code><span class="n">el</span> <span class="o">=</span> <span class="no">Element</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="s1">'#container'</span><span class="p">)</span>
<span class="n">el</span><span class="p">.</span><span class="nf">css</span> <span class="s1">'color'</span><span class="p">,</span> <span class="s1">'blue'</span>
<span class="n">el</span><span class="p">.</span><span class="nf">css</span> <span class="s1">'color'</span>
<span class="c1"># =&gt; 'blue'</span>
</code></pre>

<h3 id="http-ajax-requests">HTTP/AJAX requests</h3>

<p>jQuery&#39;s Ajax implementation is also wrapped in the top level HTTP
class.</p>
<pre class="highlight ruby"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/users/1.json"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span>
  <span class="c1"># =&gt; "{\"name\": \"Adam Beynon\"}"</span>
<span class="k">end</span>
</code></pre>

<p>The block passed to this method is used as the handler when the request
succeeds, as well as when it fails. To determine whether the request
was successful, use the <code>ok?</code> method:</p>
<pre class="highlight ruby"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/users/2.json"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="nf">ok?</span>
    <span class="n">alert</span> <span class="s2">"successful!"</span>
  <span class="k">else</span>
    <span class="n">alert</span> <span class="s2">"request failed :("</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>It is also possible to use a different handler for each case:</p>
<pre class="highlight ruby"><code><span class="n">request</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/users/3.json"</span><span class="p">)</span>

<span class="n">request</span><span class="p">.</span><span class="nf">callback</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">"Request worked!"</span>
<span class="p">}</span>

<span class="n">request</span><span class="p">.</span><span class="nf">errback</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">"Request didn't work :("</span>
<span class="p">}</span>
</code></pre>

<p>The request is actually triggered inside the <code>HTTP.get</code> method, but due
to the async nature of the request, the callback and errback handlers can
be added anytime before the request returns.</p>

<h4 id="handling-responses">Handling responses</h4>

<p>Web apps deal with JSON responses quite frequently, so there is a useful
<code>#json</code> helper method to get the JSON content from a request:</p>
<pre class="highlight ruby"><code><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/users.json"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">body</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span>
<span class="k">end</span>

<span class="c1"># =&gt; "[{\"name\": \"Adam\"},{\"name\": \"Ben\"}]"</span>
<span class="c1"># =&gt; [{"name" =&gt; "Adam"}, {"name" =&gt; "Ben"}]</span>
</code></pre>

<p>The <code>#body</code> method will always return the raw response string.</p>

<p>If an error is encountered, then the <code>#status_code</code> method will hold the
specific error code from the underlying request:</p>
<pre class="highlight ruby"><code><span class="n">request</span> <span class="o">=</span> <span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/users/3.json"</span><span class="p">)</span>

<span class="n">request</span><span class="p">.</span><span class="nf">callback</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">"it worked!"</span> <span class="p">}</span>

<span class="n">request</span><span class="p">.</span><span class="nf">errback</span> <span class="p">{</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"failed with status </span><span class="si">#{</span><span class="n">response</span><span class="p">.</span><span class="nf">status_code</span><span class="si">}</span><span class="s2">"</span>
<span class="p">}</span>
</code></pre>

      </div>
    </div>
  </div>

  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  Powered by <a href="https://github.com/opal/">Opal</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
