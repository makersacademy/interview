<!doctype html>
<html style="background-color: #f5f5f5; min-height: 100%;">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

  <title>RSpec</title>

  <link href="../../stylesheets/application.css" rel="stylesheet" />
  <link href="http://code.ionicframework.com/ionicons/1.4.1/css/ionicons.min.css" rel="stylesheet" />
  <script src="../../javascripts/application.js"></script>
</head>
<body class="docs docs_rspec docs_rspec_index">
  <nav class='navbar navbar-default opal-nav' role='navigation'>
  <div class='container'>
    <div class='navbar-header'>
      <a class='navbar-brand' href='/'>
        <img height='22' src='http://assets.makersacademy.com/images/logo/ma-white.png' width='44'>
        Makers Academy
      </a>
      <button class='navbar-toggle' data-target='#opal-navbar' data-toggle='collapse' type='button'>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
        <span class='icon-bar'></span>
      </button>
    </div>
    <div class='navbar-collapse collapse' id='opal-navbar'>
      <ul class='nav navbar-nav'>
        <li>
          <a href='https://github.com/makersacademy'>
            <i class='ion-social-github'></i>
            GitHub
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  <script>$('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent().addClass('active')</script>

  <div class="container">
      <div class="container">
    <div class="row">
      <div class="col-sm-12">
        <h1>RSpec</h1>
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 col-md-push-8">
        <ul class="nav opal-sidebar">
<ul class="subchapter">
<li class="toc-list-subchapter"><a href="#installation">Installation</a></li>
</ul>
<li class="toc-list-chapter"><a href="#running-specs">Running specs</a>
<ul class="subchapter">
<li class="toc-list-subchapter"><a href="#phantomjs">phantomjs</a>
<li class="toc-list-subchapter"><a href="#in-a-browser">In a Browser</a></li>
</ul>
<li class="toc-list-chapter"><a href="#async-examples">Async examples</a></li></ul>
      </div>

      <div class="col-md-8 col-md-pull-4">
        <h1 id="rspec">RSpec</h1>

<p><code>opal-rspec</code> allows Opal to use rspec for running specs in javascript
environments. It comes with built-in support for running rspec with custom
<code>phantomjs</code> and standard web browser formatters. Also, async spec examples
are supported to reflect browser usage of ruby applications.</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">User</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s2">"can be created with a name"</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="no">User</span><span class="p">.</span><span class="nf">new</span><span class="p">).</span><span class="nf">to_not</span> <span class="n">be_persisted</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<h3 id="installation">Installation</h3>

<p>Add the <code>opal-rspec</code> gem to your Gemfile:</p>
<pre class="highlight ruby"><code><span class="c1"># Gemfile</span>
<span class="n">gem</span> <span class="s1">'opal'</span>
<span class="n">gem</span> <span class="s1">'opal-rspec'</span>
</code></pre>

<h2 id="running-specs">Running specs</h2>

<h3 id="phantomjs">phantomjs</h3>

<p>To run specs, a rake task can be added which will load all spec files
from <code>spec/</code>:</p>
<pre class="highlight ruby"><code><span class="c1"># Rakefile</span>
<span class="nb">require</span> <span class="s1">'opal/rspec/rake_task'</span>
<span class="no">Opal</span><span class="o">::</span><span class="no">RSpec</span><span class="o">::</span><span class="no">RakeTask</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:default</span><span class="p">)</span>
</code></pre>

<p>Then, to run your specs inside phantomjs, just run the rake task:</p>
<pre class="highlight shell"><code><span class="gp">$ </span>bundle <span class="nb">exec </span>rake
</code></pre>

<h3 id="in-a-browser">In a Browser</h3>

<p><code>opal-rspec</code> can use sprockets to build and serve specs over a simple rack server. Add the following to a <code>config.ru</code> file:</p>
<pre class="highlight ruby"><code><span class="c1"># config.ru</span>
<span class="nb">require</span> <span class="s1">'bundler'</span>
<span class="no">Bundler</span><span class="p">.</span><span class="nf">require</span>

<span class="n">run</span> <span class="no">Opal</span><span class="o">::</span><span class="no">Server</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">main</span> <span class="o">=</span> <span class="s1">'opal/rspec/sprockets_runner'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">append_path</span> <span class="s1">'spec'</span>
  <span class="n">s</span><span class="p">.</span><span class="nf">debug</span> <span class="o">=</span> <span class="kp">false</span>
<span class="p">}</span>
</code></pre>

<p>Then run the rack server bundle exec rackup and visit <code>http://localhost:9292</code> in any web browser.</p>

<h2 id="async-examples">Async examples</h2>

<p><code>opal-rspec</code> adds support for async specs to rspec. These specs are defined using
<code>#async</code> instead of <code>#it</code>:</p>
<pre class="highlight ruby"><code><span class="n">describe</span> <span class="no">MyClass</span> <span class="k">do</span>
  <span class="c1"># normal example</span>
  <span class="n">it</span> <span class="s1">'does something'</span> <span class="k">do</span>
    <span class="n">expect</span><span class="p">(</span><span class="ss">:foo</span><span class="p">).</span><span class="nf">to</span> <span class="n">eq</span><span class="p">(</span><span class="ss">:foo</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># async example</span>
  <span class="n">async</span> <span class="s1">'does something else, too'</span> <span class="k">do</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>This just marks the example as running async. To actually handle the async result,
you also need to use a <code>run_async</code> call inside some future handler:</p>
<pre class="highlight ruby"><code><span class="n">async</span> <span class="s1">'HTTP requests should work'</span> <span class="k">do</span>
  <span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s1">'/users/1.json'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span>
    <span class="n">run_async</span> <span class="p">{</span>
      <span class="n">expect</span><span class="p">(</span><span class="n">res</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_ok</span>
    <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>

<p>The block passed to <code>run_async</code> informs the runner that this spec is finished
so it can move on. Any failures/expectations run inside this block will be run
in the context of the example.</p>

      </div>
    </div>
  </div>

  </div>

  <!-- GOOGLE ANALYTICS -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35688734-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<footer>
  Powered by <a href="https://github.com/opal/">Opal</a>
</footer>


  <script>
    $('a[href="'+location.pathname.replace(/\/$/,'')+'"]').parent('li').addClass('active')
  </script>
</body>
</html>
